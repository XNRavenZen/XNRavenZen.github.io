<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在vuepress里面用组合式API写全局loading | zen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/image/icon/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/image/icon/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/image/icon/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Coding & Sleeping">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/image/icon/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d7daf976.css" as="style"><link rel="preload" href="/assets/js/styles.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/app.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/16.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/24.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/34.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/20.0.0.1.1609039178414.min.js" as="script"><link rel="preload" href="/assets/js/4.0.0.1.1609039178414.min.js" as="script"><link rel="prefetch" href="/assets/js/10.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/11.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/12.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/13.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/14.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/15.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/17.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/18.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/19.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/2.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/21.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/22.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/23.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/25.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/26.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/27.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/28.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/29.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/3.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/30.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/31.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/32.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/33.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/35.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/36.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/5.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/6.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/7.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/8.0.0.1.1609039178414.min.js"><link rel="prefetch" href="/assets/js/9.0.0.1.1609039178414.min.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d7daf976.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="global-layout"><header><span class="icon zen zen-menu"></span> <a href="/" class="router-link-active">zen's blog</a>
     
    <a href="/tag/">Tag</a>
     
     <a href="/github/"></a></header> <aside class="menu-bar"><div class="portrait"><img src="/image/avatar/husky_stuck-out_tongue.jpg" alt class="portrait-avatar"></div></aside> <!----> <div class="container"><div><div class="content__default"><h3 id="需求">需求</h3> <p>页面请求时有家在动画的需求,实际情况中,不太想每个页面都加一个加载动画组件.于是......</p> <h3 id="代码">代码</h3> <ul><li>由于使用了组合式API,Vue.extend等改成了createApp</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> compositionAPI<span class="token punctuation">,</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/composition-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DataLoading <span class="token keyword">from</span> <span class="token string">&quot;../components/DataLoading.vue&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>compositionAPI<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ToastSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>DataLoading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">showLoading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">isShow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 由于vuepress对浏览器API访问限制</span>
    <span class="token keyword">const</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parent<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;loading-container&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    instance<span class="token punctuation">[</span>isShow <span class="token operator">?</span> <span class="token string">&quot;showLoad&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;hideLoad&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> showLoading <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>之后为了暴露这个 showLoading 给所有页面使用废了一番功夫
<ol><li>由于 setup 里面无法使用this, prototype 直接 ×</li> <li>尝试用 provide 和 inject, 刷新时inject获取不到方法 ×</li> <li>最后用了 vuex, 把方法存在state里面
<ol><li>由于1的原因且setup也找不到store,直接到根实例获取$store</li></ol></li></ol></li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//  ...</span>
   <span class="token keyword">const</span> store <span class="token operator">=</span> context<span class="token punctuation">.</span>root<span class="token punctuation">.</span>$store<span class="token punctuation">;</span>
   store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>xxxFunc
  <span class="token comment">//  ...</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>未完待续</p></blockquote></div></div></div> <footer><div class="icpRecord"><a href="http://beian.miit.gov.cn/" target="_blank" class="ace-link"><span class="record-link-text">闽ICP备2020022217号-1</span></a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=35020602001871"><img src="/image/icon/national_emblem.png" class="record-link-icon"> <span class="record-link-text">闽公网安备 35020602001871号</span></a></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/styles.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/16.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/24.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/34.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/20.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/4.0.0.1.1609039178414.min.js" defer></script><script src="/assets/js/app.0.0.1.1609039178414.min.js" defer></script>
  </body>
</html>
